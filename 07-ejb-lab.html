<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Laboratorio EJB (Esercizio 0) - Programmazione Distribuita</title>


        <!-- Custom HTML head -->

        <meta name="description" content="materiale di supporto al corso di Programmazione Distribuita">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-73480f44.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-472034f3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Programmazione Distribuita</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li><a href="#esercizio-0---hello-world-ejb">Esercizio 0 - Hello World EJB</a></li>
<li>
<ul>
<li><a href="#esercizi-di-riscaldamento">Esercizi di riscaldamento</a></li>
<li><a href="#esercizio-b1---calcolatrice-ejb">Esercizio B.1 - Calcolatrice EJB</a></li>
<li><a href="#esercizio-b2---calcolatrice-ejb-basata-su-stack">Esercizio B.2 - Calcolatrice EJB basata su stack</a></li>
<li><a href="#esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente">Esercizio B.3 - Calcolatrice EJB basata su stack persistente</a></li>
</ul>
</li>
<li><a href="#esercizio-1---music-library--warm-up-">Esercizio 1 - Music Library üéµüìö (warm-up üèã)</a>
<ul>
<li><a href="#music-library">Music Library</a>
<ul>
<li><a href="#definizione-entit√†-e-persistenza">Definizione entit√† e persistenza</a></li>
<li><a href="#definizione-della-logica-della-nostra-applicazione">Definizione della logica della nostra applicazione</a></li>
</ul>
</li>
<li><a href="#music-library-client">Music Library Client</a></li>
</ul>
</li>
<li><a href="#esercizio-2---music-library-">Esercizio 2 - Music Library++ üéµüìö</a></li>
<li><a href="#esercizio-3---pdtify--Ô∏è">Esercizio 3 - PDtify üéµ ‚èØÔ∏è</a></li>
</ul>
<blockquote>
<p>üöÄ Se avete problemi con la lookup dei vostri bean potete verificare che state utilizzando il dominio corretto con i parametri di default nel file <code>[USER_HOME]/GlassFish_Server/glassfish/domains/domain1/config/domain.xml</code>. Il pacchetto <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code> carica configurazioni per l‚ÄôInitialContext di default (<a href="https://docs.oracle.com/cd/E26576_01/doc.312/e24928/overview.htm#GSADG00004">GlassFish Server Administration Guide</a>).</p>
</blockquote>
<blockquote>
<p>‚ùì Esempio di setting della porta per il servizio IIOP necessario per il discovery di RMI:</p>
</blockquote>
<pre><code class="language-java">Properties props = new Properties();
props.setProperty("java.naming.factory.initial",
"com.sun.enterprise.naming.SerialInitContextFactory");
props.setProperty("java.naming.factory.url.pkgs",
"com.sun.enterprise.naming");
props.setProperty("java.naming.factory.state",
"com.sun.corba.ee.impl.presentation.rmi.JNDIStateFactoryImpl");
props.setProperty("org.omg.CORBA.ORBInitialHost", "localhost");
props.setProperty("org.omg.CORBA.ORBInitialPort", "3700");
Context ctx = new InitialContext(props);
</code></pre>
<h1 id="esercizio-0---hello-world-ejb"><a class="header" href="#esercizio-0---hello-world-ejb">Esercizio 0 - Hello World EJB</a></h1>
<p>Ripetere l‚Äôesercitazione visto a lezione per la definizione di un nuovo <em>stateless</em> EJB <code>HelloWorld</code> che implementa un metodo <code>sayHello(String text)</code> che restituisce una stringa di saluto. Il client deve essere un applicazione Java che invoca il metodo remoto <code>sayHello("Hello my name is "+name)</code> e stampa il risultato a console.</p>
<blockquote>
<p>üöÄ Includere nell‚Äôapplicazione Java SE Client il pacchetto <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code> per la lookup del bean remoto. Definendo la sua interfaccia remota <code>HelloWorldRemote.java</code> come segue:</p>
</blockquote>
<pre><code class="language-java">@Remote
public interface HelloWorldEJBRemote{
    public String sayHello(String name);
}
</code></pre>
<h1 id="esercizi-di-riscaldamento"><a class="header" href="#esercizi-di-riscaldamento">Esercizi di riscaldamento</a></h1>
<h2 id="esercizio-b1---calcolatrice-ejb"><a class="header" href="#esercizio-b1---calcolatrice-ejb">Esercizio B.1 - Calcolatrice EJB</a></h2>
<p>Scrivere un client Java che invoca degli EJB sul server che implementano un servizio di calcolatrice per tipi float. La calcolatrice offre tre metodi, tutti prendono in input due operandi di tipo <code>float</code> e restituiscono un <code>float</code>:</p>
<ul>
<li><code>add(float,float)</code></li>
<li><code>sub(float,float)</code></li>
<li><code>multiply(float,float)</code></li>
</ul>
<p>Il server offre inoltre un servizio di counting <code>count()</code> che restituisce il numero di operazioni effettuate da tutti i clienti dall‚Äôavvio del server. Il client deve offrire da console un interfaccia che permetta di effettuare tutte le operazioni da remoto.</p>
<h2 id="esercizio-b2---calcolatrice-ejb-basata-su-stack"><a class="header" href="#esercizio-b2---calcolatrice-ejb-basata-su-stack">Esercizio B.2 - Calcolatrice EJB basata su stack</a></h2>
<p>Scrivere un client Java che invoca degli Enterprise EJB sul server che implementano un servizio di calcolatrice basata su stack per tipi <code>float</code>. La calcolatrice offre cinque metodi. Tre di questi metodi rappresentano operazioni aritmetiche che non prendono input e operano direttamente sui dati nello stack: <code>add()</code>, <code>sub()</code>, <code>multiply()</code>.
In aggiunta, il server offre il metodovoid <code>push(float)</code> e <code>float pop()</code> per la gestione dello stack. Nota che l‚Äôunico metodo che restituisce valori √® la <code>pop()</code>. Le operazione aritmetiche eseguono implicitamente due <code>pop()</code> per prelevare gli operandi e una <code>push()</code> per salvare il valore di ritorno.</p>
<p>Esempio di esecuzione del servizio:</p>
<ul>
<li><code>push(3)</code>, <code>push(4)</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 7</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>multiply()</code>, <code>pop()</code> ‚û°Ô∏è 12</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>push(1)</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 5</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>push(1)</code>, <code>add()</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 8</li>
</ul>
<p>Avanzato: gestire i meccanismi di attivazione e passivazione.</p>
<h2 id="esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente"><a class="header" href="#esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente">Esercizio B.3 - Calcolatrice EJB basata su stack persistente</a></h2>
<p>Estendere il servizio di calcolatrice basata su stack implementata nell‚Äôesercizio precedente aggiungendo un livello di persistenza dello stack. In particolare, ad ogni operazione, lo stack deve essere salvato su database. All‚Äôinterfaccia del servizio verr√† aggiunto il metodo <code>loadStack(String stackName)</code> e <code>saveStack(String stackName)</code> che consentono all‚Äôutente di caricare lo stack da database . Se il client non invoca la <code>loadStack()</code>, la sessione si avvia con uno stack vuoto. Lo stack puo essere salvato nel formato piu appropriato, anche come stringa.</p>
<p>Al fine di completare l‚Äôesercizo, occorre</p>
<ol>
<li>Implementare il metodo <code>loadStack(String username)</code>.</li>
<li>Implementare il metodo <code>saveStack(String username)</code>.</li>
<li>Implementare un metodo <code>stackList()</code> che restituisce tutti i nomi degli stack
salvati su database.</li>
<li>Implementare un interceptor che, alla fine dell‚Äôinterazione con un client, stampa una
lista dei stackName usati da quell‚Äôutente in quella sessione.</li>
</ol>
<h1 id="esercizio-1---music-library--warm-up-"><a class="header" href="#esercizio-1---music-library--warm-up-">Esercizio 1 - Music Library üéµüìö (warm-up üèã)</a></h1>
<p>Creare due progetti:</p>
<ul>
<li><strong>MusicLibrary</strong>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Enterprise ‚û°Ô∏è EJB Module</li>
<li><strong>MusicLibraryClient</strong>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Application (con una main class)</li>
</ul>
<h2 id="music-library"><a class="header" href="#music-library">Music Library</a></h2>
<p>Creare un nuovo pacchetto Source Packages ‚û°Ô∏è New ‚û°Ô∏è Java Package <code>it.pd2024.musiclibrary</code></p>
<h3 id="definizione-entit√†-e-persistenza"><a class="header" href="#definizione-entit√†-e-persistenza">Definizione entit√† e persistenza</a></h3>
<ul>
<li><code>Song.java</code> definisce un entit√† persistente che identifica un brano musicale.</li>
</ul>
<pre><code class="language-java">//import packages
import static it.pd2022.musiclibrary.Song.TROVA_TUTTE;
@Entity
@NamedQueries({
    @NamedQuery(name = TROVA_TUTTE, query = "SELECT s FROM Song s"),
})
public class Song implements Serializable{
    public static final String TROVA_TUTTE = "Song.trovaTutteCanzoni";
    @Id @GeneratedValue
    private Long ID;
    private String authors;
    private String name;
    private URL url; //link youtube 
    public Song() { }
    public Song(String authors, String name, URL url) {
        this.authors = authors;
        this.name = name;
        this.url = url;
    }
    //Insert code -&gt; getters and setter
    //Insert code -&gt; toString()
}
</code></pre>
<p><strong>Nota</strong>: ottenere i link da youtube utilizzando il tasto <em>Condividi</em> ‚û°Ô∏è <em>Incorpora</em> dal player youtube.</p>
<ul>
<li>Dobbiamo denifire una nuova Persistence Unit in modalit√† JTA: <code>MusicLibraryPU</code>
<ul>
<li>New ‚û°Ô∏è Persistence Unit, e come segue:</li>
</ul>
</li>
</ul>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence     http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="MusicLibraryPU" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;java:global/jdbc/MusicLibraryDataSource&lt;/jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="eclipselink.target-database" value="DERBY"/&gt;
      &lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;
      &lt;property name="eclipselink.logging.level" value="INFO"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</code></pre>
<ul>
<li>Creaiamo un nuovo Singleton istanziato in fase di avvio dell‚Äôapplicazione che consente l‚Äôinizializzazione e la definizione di un nuovo database e datasource per la nostra applicazione: <code>DatabasePopulator.java</code></li>
</ul>
<pre><code class="language-java">@Singleton
@Startup 
@DataSourceDefinition(
    className ="org.apache.derby.jdbc.EmbeddedDataSource", name ="java:global/jdbc/MusicLibraryDataSource",
    user ="APP",
    password ="APP",
    databaseName ="MusicLibraryDB",
    properties = {"connectionAttributes=;create=true"} 
)
public class DatabasePopulator { 
   
    //PER ORA VUOTO
}
</code></pre>
<blockquote>
<p>üöÄ A questo punto la parte base della persistenza √® terminata e possiamo eseguire la build del progetto e il deploy su GlassFish.</p>
</blockquote>
<h3 id="definizione-della-logica-della-nostra-applicazione"><a class="header" href="#definizione-della-logica-della-nostra-applicazione">Definizione della logica della nostra applicazione</a></h3>
<p>Le funzionalit√† dell‚Äôapplicazione saranno definite in un enterprise java bean stateless chiamato <code>MusicLibrary.java</code>, che saranno offerte ai client (applicazioni Java) tramite l‚Äôinvocazione di metodi remoti, quindi dovremo definire ed implementare un interfaccia remota <code>MusicLibraryRemote.java</code>.</p>
<pre><code class="language-java">@Stateless
@LocalBean
public class MusicLibrary implements MusicLibraryRemote{
    
    @Inject
    private EntityManager em; 

    public List&lt;Song&gt; findSongs() {
        TypedQuery&lt;Song&gt; query = em.createNamedQuery(Song.TROVA_TUTTE, Song.class);
        return query.getResultList();
    }
    public Song createSong( Song song) {
        em.persist(song);
        return song;
    }
}
</code></pre>
<pre><code class="language-java">@Remote
public interface MusicLibraryRemote {
    public List&lt;Song&gt; findSongs();
    public Song createSong(Song song);
}
</code></pre>
<p>Nella definzione del nostro EJB MusicLibrary utilizziamo l‚Äôiniezione di una dipendenza ad un <code>EntityManager</code> di conseguenza dobbiamo definire un metodo per la ‚Äúproduzione‚Äù di tale oggetto in una classe <code>DatabaseProducer.java</code> come segue.</p>
<pre><code class="language-java">public class DatabaseProducer {
     
    @Produces
    @PersistenceContext(unitName ="MusicLibraryPU") 
    private EntityManager em;
}

</code></pre>
<ul>
<li>Prima di proseguire dobbiamo include nel nostro progetto la definizione del file <code>beans.xml</code>che ci permette di impostare la disscovery mode dei nostri beans a all.
<ul>
<li>New File ‚û°Ô∏è Contexts and Dependency Injection ‚û°Ô∏è beans.xml, impostare <code>bean-discovery-mode="all"</code></li>
</ul>
</li>
<li>A questo punto possiamo completare il nostro <code>DatabasePopulator.java</code>inserendo nel database alcune canzoni di esempio ed utilizzando l‚ÄôEJB MusicLibrary. Possiamo inserire la definizione del seguente metodo:</li>
</ul>
<pre><code class="language-java">private Song s1, s2; 
@Inject
private MusicLibrary lib;

@PostConstruct
private void populateDB() {
    try {
        s1 = new Song("Queen","We Are The Champions", new URL("https://www.youtube.com/embed/KXw8CRapg7k"));
        s2 = new Song("Home Free", "Sea Shanty Medley", new URL("https://www.youtube.com/embed/lLGLUSzzuWU"));
        lib.createSong(s1);
        lib.createSong(s2);
    } catch (MalformedURLException ex) {
        Logger.getLogger(DatabasePopulator.class.getName()).log(Level.SEVERE, null, ex);
    }
}
</code></pre>
<blockquote>
<p>üöÄ La parte di logica √® terminata e possiamo eseguire la build del progetto e il deploy su GlassFish.</p>
</blockquote>
<h2 id="music-library-client"><a class="header" href="#music-library-client">Music Library Client</a></h2>
<p>Prima di procedere con lo sviluppo del nostro java client dobbiamo specificare le dipendenze necessarie:</p>
<ul>
<li>1Ô∏è‚É£ Progetto <code>MusicLibrary</code>: Properties ‚û°Ô∏è Libraries ‚û°Ô∏è  Classpath ‚ûï  ‚û°Ô∏è Add Projects‚Ä¶  ‚û°Ô∏è <code>MusicLibrary</code></li>
<li>2Ô∏è‚É£ Libreria <code>gf-client.jar</code>: Properties ‚û°Ô∏è Libraries ‚û°Ô∏è  Classpath ‚ûï  ‚û°Ô∏è Add JAR/Folder ‚û°Ô∏è <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code>, la libreria si trova nella vostra installazione di glassfish nel path specificato.</li>
</ul>
<pre><code class="language-java">public class MusicLibraryClient {

    public static void main(String[] args) throws NamingException {
        Context ctx = new InitialContext();
        MusicLibraryRemote ejb = (MusicLibraryRemote) ctx.lookup("java:global/MusicLibrary/MusicLibrary!it.pd2022.musiclibrary.MusicLibraryRemote");
        
        List&lt;Song&gt; lista = ejb.findSongs();
        for(Song s: lista)
            System.out.println(s);
    }
    
}
</code></pre>
<blockquote>
<p>üöÄ Il client della nostra applicazione √® pronto possiamo eseguirlo.
üéØ Output:</p>
<pre><code>run: nov 06, 2022 1:32:13 PM com.sun.enterprise.v3.server.CommonClassLoaderServiceImpl findDerbyClient
INFORMAZIONI: Cannot find javadb client jar file, derby jdbc driver will not be available by default.
Song{ID=2, authors=Home Free, name=Sea Shanty Medley, url=https://www.youtube.com/watch?v=lLGLUSzzuWU&amp;ab_channel=HomeFree}
Song{ID=1, authors=Queen, name=We Are The Champions, url=https://www.youtube.com/watch?v=KXw8CRapg7k&amp;ab_channel=QueenVEVO}
BUILD SUCCESSFUL (total time: 2 seconds)
</code></pre>
</blockquote>
<p><strong>Nota</strong> l‚Äôindirizzo JNDI dell‚Äôinterfaccia remota del bean MusicLibrary pu√≤ essere visualizzato nella console di output di glassfish subito dopo il deploy dell‚Äôapplicazione.</p>
<h1 id="esercizio-2---music-library-"><a class="header" href="#esercizio-2---music-library-">Esercizio 2 - Music Library++ üéµüìö</a></h1>
<p>Aggiungere le seguenti funzionalit√† al progetto MusicLibrary:</p>
<ol>
<li>
<p>Ampliare la definzione di <code>Song</code> inserendo:</p>
<ul>
<li>anno di rilascio,</li>
<li>numero di visualizzazioni (numero di volte in cui il bravo √® stato riprodotto),</li>
<li>lyrics;</li>
<li>specificare delle nuove NamedQuery che permettano la ricerca delle canzoni per anno di rilascio, nome autore, nome del brano.</li>
</ul>
</li>
<li>
<p>Definire una nuova entit√† <code>Playlist</code> che consente di collezionare molteplici <code>Song</code>, specificando</p>
<ul>
<li>nome,</li>
<li>autore,</li>
<li>tipologia,</li>
<li>descrizione,</li>
<li>data in cui √® stato effettuato l‚Äôultimo aggiornamento.</li>
</ul>
<p>Le playlist possono essere create, modificate, visualizzate, ricercate per tipologia, ed eliminate senza eliminare dal database i brani contenuti.</p>
</li>
<li>
<p>Ampliare la definizione di <code>MusicLibrary</code> per supportare le precedenti nuove entit√† e funzionalit√†.</p>
<ul>
<li>Introdurre la definizione di una metodo <code>play(song_ID)</code> che permette di ottenere la URL di una song, questo metodo va intercettato per aggiornare il numero di volte che un particolare brano viene riprodotto. Modificare il file <code>beans.xml</code> per aggiungere la definizione del nuovo interceptor:</li>
</ul>
<pre><code class="language-xml">  &lt;beans xmlns="http://xmlns.jcp.org/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"
        version="1.1" bean-discovery-mode="all"&gt;
    &lt;interceptors&gt;
       &lt;class&gt;org.agoncal.book.javaee7.chapter02.LoggingInterceptor&lt;/class&gt;
     &lt;/interceptors&gt;
 &lt;/beans&gt;
</code></pre>
<ul>
<li><em>Opzionale</em>: estendere la definizione del metodo play per la riproduzione di un lista di brani ottenuti da una particolare playlist.</li>
</ul>
</li>
</ol>
<p>Mofificare la classe main di <code>MusicLibraryClient</code> per il testing e la verifica di tutte le funzionalit√† di <code>MusicLibrary</code>.</p>
<h1 id="esercizio-3---pdtify--"><a class="header" href="#esercizio-3---pdtify--">Esercizio 3 - PDtify üéµ ‚èØÔ∏è</a></h1>
<p><strong>Obiettivo</strong>: creare un enterprise java application con due moduli principali un modulo di business/persistenza e un modulo di presentazione web che permetta la gestione di una libreria musicale evoluta (playlist) utilizzando come player di riproduzione web le API di Youtube Embedded.</p>
<ul>
<li>‚ö†Ô∏è <strong>prima di procedere effettuare l‚Äôundeploy del progetto precedente dal server glassfish</strong>.</li>
<li><code>PDtify</code>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Enterprise ‚û°Ô∏è Enterprise Application</li>
<li>Output in Netbeans:
<ul>
<li><code>PDtify</code> enterprise application.</li>
<li><code>PDtify-ejb</code> un modulo ejb.</li>
<li><code>PDtify-web</code> un modulo web.</li>
</ul>
</li>
<li>Riportare il progetto <code>MusicLibray</code> nel modulo <code>PDtify-ejb</code>.</li>
<li>Costruire un nuovo client web utilizzando una servelet <code>MusicPlayer</code> che sfrutta l‚ÄôEJB <code>MusicLibrary</code> per offrire attraverso una pagina web tutte le funzionalit√† dell‚Äôapplicazione. Quando si crea la Servlet specificare <em>Add information to the deployment descriptor (web.xml)</em> passaggio 2 del wizard di creazione della Servlet.</li>
<li><em>Note</em>:
<ul>
<li>riportare nel modulo ejb tutte le definizione di persistence e beans.xml;</li>
<li>quando si eseguono le operazioni di build, deploy, e run del progetto vanno lanciate dal progetto principale entrprise <code>PDtify</code>;</li>
<li>per specificare che di default la index della nostra applicazione sar√† la Servlet <code>MusicPlayer</code> modificare il file <code>PDtify-war/Web Pages/WEB-INF/web.xml</code> come segue:
<pre><code class="language-xml">    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;MusicPlayer&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</code></pre>
</li>
</ul>
</li>
<li><code>play()</code>la visualizzazione del metodo play pu√≤ essere ottenuta utilizzando l‚Äôembedding della URL di un brano all‚Äôinterno di un iframe:
<pre><code class="language-java">     Song s =  new Song("Queen","We Are The Champions", new URL("https://www.youtube.com/embed/KXw8CRapg7k"));
     out.println("&lt;iframe width=\"420\""+
                         "height=\"315\"\n" +
                         "src=\""+s.getUrl()+"\"&gt;\n" +
                 "&lt;/iframe&gt;");
</code></pre>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="06-ejb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="07-jms.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="06-ejb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="07-jms.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
