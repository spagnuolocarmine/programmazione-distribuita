<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Laboratorio EJB - Programmazione Distribuita</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="materiale di supporto al corso di Programmazione Distribuita">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Programmazione Distribuita</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="blog.html"><strong aria-hidden="true">1.1.</strong> üîó Blog</a></li><li class="chapter-item expanded "><a href="esame_con_intercorso.html"><strong aria-hidden="true">1.2.</strong> üìù Esame: modalit√† con prove intercorso per studenti corsisti</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> 1Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> Presentazione del corso</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> Introduzione al calcolo distribuito</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> Java Thread 1</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> 2Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Java Thread 2-3</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> laboratorio Java Thread</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> Java Socket TCP 1</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> 3Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Java Socket TCP 2</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Java Remote Method Invocation (RMI) 1</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-rmi.html"><strong aria-hidden="true">4.2.1.</strong>  Hello World RMI</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> RMI 2</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> 4Ô∏è‚É£ üìïüìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-rmi.html"><strong aria-hidden="true">5.1.</strong> Laboratorio Java RMI</a></li><li class="chapter-item expanded "><a href="04-javaee.html"><strong aria-hidden="true">5.2.</strong> Introduzione Java Enterprise Edition (Java EE)</a></li><li class="chapter-item expanded "><a href="04-cdi.html"><strong aria-hidden="true">5.3.</strong> Contexts and Dependency Injection (CDI) - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> 5Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="05-javaee-lab.html"><strong aria-hidden="true">6.1.</strong> Laboratorio Java EE</a></li><li class="chapter-item expanded "><a href="04-cdi.html"><strong aria-hidden="true">6.2.</strong> Contexts and Dependency Injection (CDI) - Part 2</a></li><li class="chapter-item expanded "><a href="05-jpa.html"><strong aria-hidden="true">6.3.</strong> Java Persistence API - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> 6Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="05-jpa.html"><strong aria-hidden="true">7.1.</strong> JPA 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="06-jpa-lab.html"><strong aria-hidden="true">7.1.1.</strong> Laboratorio JPA</a></li></ol></li><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">7.2.</strong> Enterprise JavaBeans (EJB) - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> 7Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">8.1.</strong> EJB - Part 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="07-ejb-lab.html" class="active"><strong aria-hidden="true">8.1.1.</strong> Laboratorio EJB (Esercizio 0)</a></li></ol></li><li class="chapter-item expanded "><a href="07-jms.html"><strong aria-hidden="true">8.2.</strong> Java Message Service - Part 1</a></li><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">8.3.</strong> JMS - Part 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> 8Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="07-ejb-lab.html" class="active"><strong aria-hidden="true">9.1.</strong> Laboratorio EJB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="08-jms-lab.html"><strong aria-hidden="true">9.1.1.</strong> JMS Lab</a></li></ol></li><li class="chapter-item expanded "><a href="08-ws.html"><strong aria-hidden="true">9.2.</strong> Java Web Services (WS) Parte 1</a></li><li class="chapter-item expanded "><a href="08-ws.html"><strong aria-hidden="true">9.3.</strong> Java WS Parte 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> 9Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="09-ws-lab.html"><strong aria-hidden="true">10.1.</strong> Laboratorio Java WS</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> Laboratorio J2EE Step-by-step</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.3.</strong> Introduzione al Cloud Computing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> 1Ô∏è‚É£0Ô∏è‚É£</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> From J2EE to Spring Framework (Teoria)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> From J2EE to Spring Framework (Pratica)</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Programmazione Distribuita</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li><a href="#esercizio-0---hello-world-ejb">Esercizio 0 - Hello World EJB</a></li>
<li><a href="#esercizio-1---music-library--warm-up-">Esercizio 1 - Music Library üéµüìö (warm-up üèã)</a>
<ul>
<li><a href="#music-library">Music Library</a>
<ul>
<li><a href="#definizione-entit%C3%A0-e-persistenza">Definizione entit√† e persistenza</a></li>
<li><a href="#definizione-della-logica-della-nostra-applicazione">Definizione della logica della nostra applicazione</a></li>
</ul>
</li>
<li><a href="#music-library-client">Music Library Client</a></li>
</ul>
</li>
<li><a href="#esercizio-2---music-library-">Esercizio 2 - Music Library++ üéµüìö</a></li>
<li><a href="#esercizio-3---pdtify--%EF%B8%8F">Esercizio 3 - PDtify üéµ ‚èØÔ∏è</a></li>
<li><a href="#esercizi-bonus">Esercizi Bonus</a>
<ul>
<li><a href="#esercizio-b1---calcolatrice-ejb">Esercizio B.1 - Calcolatrice EJB</a></li>
<li><a href="#esercizio-b2---calcolatrice-ejb-basata-su-stack">Esercizio B.2 - Calcolatrice EJB basata su stack</a></li>
<li><a href="#esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente">Esercizio B.3 - Calcolatrice EJB basata su stack persistente</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>üöÄ Se avete problemi con la lookup dei vostri bean potete verificare che state utilizzando il dominio corretto con i parametri di default nel file <code>[USER_HOME]/GlassFish_Server/glassfish/domains/domain1/config/domain.xml</code>. Il pacchetto <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code> carica configurazioni per l'InitialContext di default (<a href="https://docs.oracle.com/cd/E26576_01/doc.312/e24928/overview.htm#GSADG00004">GlassFish Server Administration Guide</a>).</p>
</blockquote>
<blockquote>
<p>‚ùì Esempio di setting della porta per il servizio IIOP necessario per il discovery di RMI:</p>
</blockquote>
<pre><code class="language-java">Properties props = new Properties();
props.setProperty("java.naming.factory.initial",
"com.sun.enterprise.naming.SerialInitContextFactory");
props.setProperty("java.naming.factory.url.pkgs",
"com.sun.enterprise.naming");
props.setProperty("java.naming.factory.state",
"com.sun.corba.ee.impl.presentation.rmi.JNDIStateFactoryImpl");
props.setProperty("org.omg.CORBA.ORBInitialHost", "localhost");
props.setProperty("org.omg.CORBA.ORBInitialPort", "3700");
Context ctx = new InitialContext(props);
</code></pre>
<h1 id="esercizio-0---hello-world-ejb"><a class="header" href="#esercizio-0---hello-world-ejb">Esercizio 0 - Hello World EJB</a></h1>
<p>Ripetere l'esercitazione visto a lezione per la definizione di un nuovo <em>stateless</em> EJB <code>HelloWorld</code> che implementa un metodo <code>sayHello(String text)</code> che restituisce una stringa di saluto. Il client deve essere un applicazione Java che invoca il metodo remoto <code>sayHello("Hello my name is "+name)</code> e stampa il risultato a console.</p>
<blockquote>
<p>üöÄ Includere nell'applicazione Java SE Client il pacchetto <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code> per la lookup del bean remoto. Definendo la sua interfaccia remota <code>HelloWorldRemote.java</code> come segue:</p>
</blockquote>
<pre><code class="language-java">@Remote
public interface HelloWorldEJBRemote{
    public String sayHello(String name);
}
</code></pre>
<h1 id="esercizio-1---music-library--warm-up-"><a class="header" href="#esercizio-1---music-library--warm-up-">Esercizio 1 - Music Library üéµüìö (warm-up üèã)</a></h1>
<p>Creare due progetti:</p>
<ul>
<li><strong>MusicLibrary</strong>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Enterprise ‚û°Ô∏è EJB Module</li>
<li><strong>MusicLibraryClient</strong>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Application (con una main class)</li>
</ul>
<h2 id="music-library"><a class="header" href="#music-library">Music Library</a></h2>
<p>Creare un nuovo pacchetto Source Packages ‚û°Ô∏è New ‚û°Ô∏è Java Package <code>√¨t.pd2023.musiclibrary</code></p>
<h3 id="definizione-entit√†-e-persistenza"><a class="header" href="#definizione-entit√†-e-persistenza">Definizione entit√† e persistenza</a></h3>
<ul>
<li><code>Song.java</code> definisce un entit√† persistente che identifica un brano musicale.</li>
</ul>
<pre><code class="language-java">//import packages
import static it.pd2022.musiclibrary.Song.TROVA_TUTTE;
@Entity
@NamedQueries({
    @NamedQuery(name = TROVA_TUTTE, query = "SELECT s FROM Song s"),
})
public class Song implements Serializable{
    public static final String TROVA_TUTTE = "Song.trovaTutteCanzoni";
    @Id @GeneratedValue
    private Long ID;
    private String authors;
    private String name;
    private URL url; //link youtube 
    public Song() { }
    public Song(String authors, String name, URL url) {
        this.authors = authors;
        this.name = name;
        this.url = url;
    }
    //Insert code -&gt; getters and setter
    //Insert code -&gt; toString()
}
</code></pre>
<p><strong>Nota</strong>: ottenere i link da youtube utilizzando il tasto <em>Condividi</em> ‚û°Ô∏è <em>Incorpora</em> dal player youtube.</p>
<ul>
<li>Dobbiamo denifire una nuova Persistence Unit in modalit√† JTA: <code>MusicLibraryPU</code>
<ul>
<li>New ‚û°Ô∏è Persistence Unit, e come segue:</li>
</ul>
</li>
</ul>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence     http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="MusicLibraryPU" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;java:global/jdbc/MusicLibraryDataSource&lt;/jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="eclipselink.target-database" value="DERBY"/&gt;
      &lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;
      &lt;property name="eclipselink.logging.level" value="INFO"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</code></pre>
<ul>
<li>Creaiamo un nuovo Singleton istanziato in fase di avvio dell'applicazione che consente l'inizializzazione e la definizione di un nuovo database e datasource per la nostra applicazione: <code>DatabasePopulator.java</code></li>
</ul>
<pre><code class="language-java">@Singleton
@Startup 
@DataSourceDefinition(
    className ="org.apache.derby.jdbc.EmbeddedDataSource", name ="java:global/jdbc/MusicLibraryDataSource",
    user ="APP",
    password ="APP",
    databaseName ="MusicLibraryDB",
    properties = {"connectionAttributes=;create=true"} 
)
public class DatabasePopulator { 
   
    //PER ORA VUOTO
}
</code></pre>
<blockquote>
<p>üöÄ A questo punto la parte base della persistenza √® terminata e possiamo eseguire la build del progetto e il deploy su GlassFish.</p>
</blockquote>
<h3 id="definizione-della-logica-della-nostra-applicazione"><a class="header" href="#definizione-della-logica-della-nostra-applicazione">Definizione della logica della nostra applicazione</a></h3>
<p>Le funzionalit√† dell'applicazione saranno definite in un enterprise java bean stateless chiamato <code>MusicLibrary.java</code>, che saranno offerte ai client (applicazioni Java) tramite l'invocazione di metodi remoti, quindi dovremo definire ed implementare un interfaccia remota <code>MusicLibraryRemote.java</code>.</p>
<pre><code class="language-java">@Stateless
@LocalBean
public class MusicLibrary implements MusicLibraryRemote{
    
    @Inject
    private EntityManager em; 

    public List&lt;Song&gt; findSongs() {
        TypedQuery&lt;Song&gt; query = em.createNamedQuery(Song.TROVA_TUTTE, Song.class);
        return query.getResultList();
    }
    public Song createSong( Song song) {
        em.persist(song);
        return song;
    }
}
</code></pre>
<pre><code class="language-java">@Remote
public interface MusicLibraryRemote {
    public List&lt;Song&gt; findSongs();
    public Song createSong(Song song);
}
</code></pre>
<p>Nella definzione del nostro EJB MusicLibrary utilizziamo l'iniezione di una dipendenza ad un <code>EntityManager</code> di conseguenza dobbiamo definire un metodo per la "produzione" di tale oggetto in una classe <code>DatabaseProducer.java</code> come segue.</p>
<pre><code class="language-java">public class DatabaseProducer {
     
    @Produces
    @PersistenceContext(unitName ="MusicLibraryPU") 
    private EntityManager em;
}

</code></pre>
<ul>
<li>Prima di proseguire dobbiamo include nel nostro progetto la definizione del file <code>beans.xml</code>che ci permette di impostare la disscovery mode dei nostri beans a all.
<ul>
<li>New File ‚û°Ô∏è Contexts and Dependency Injection ‚û°Ô∏è beans.xml, impostare <code>bean-discovery-mode="all"</code></li>
</ul>
</li>
<li>A questo punto possiamo completare il nostro <code>DatabasePopulator.java</code>inserendo nel database alcune canzoni di esempio ed utilizzando l'EJB MusicLibrary. Possiamo inserire la definizione del seguente metodo:</li>
</ul>
<pre><code class="language-java">private Song s1, s2; 
@Inject
private MusicLibrary lib;

@PostConstruct
private void populateDB() {
    try {
        s1 = new Song("Queen","We Are The Champions", new URL("https://www.youtube.com/embed/KXw8CRapg7k"));
        s2 = new Song("Home Free", "Sea Shanty Medley", new URL("https://www.youtube.com/embed/lLGLUSzzuWU"));
        lib.createSong(s1);
        lib.createSong(s2);
    } catch (MalformedURLException ex) {
        Logger.getLogger(DatabasePopulator.class.getName()).log(Level.SEVERE, null, ex);
    }
}
</code></pre>
<blockquote>
<p>üöÄ La parte di logica √® terminata e possiamo eseguire la build del progetto e il deploy su GlassFish.</p>
</blockquote>
<h2 id="music-library-client"><a class="header" href="#music-library-client">Music Library Client</a></h2>
<p>Prima di procedere con lo sviluppo del nostro java client dobbiamo specificare le dipendenze necessarie:</p>
<ul>
<li>1Ô∏è‚É£ Progetto <code>MusicLibrary</code>: Properties ‚û°Ô∏è Libraries ‚û°Ô∏è  Classpath ‚ûï  ‚û°Ô∏è Add Projects...  ‚û°Ô∏è <code>MusicLibrary</code></li>
<li>2Ô∏è‚É£ Libreria <code>gf-client.jar</code>: Properties ‚û°Ô∏è Libraries ‚û°Ô∏è  Classpath ‚ûï  ‚û°Ô∏è Add JAR/Folder ‚û°Ô∏è <code>[USER_HOME]/GlassFish_Server/glassfish/lib/gf-client.jar</code>, la libreria si trova nella vostra installazione di glassfish nel path specificato.</li>
</ul>
<pre><code class="language-java">public class MusicLibraryClient {

    public static void main(String[] args) throws NamingException {
        Context ctx = new InitialContext();
        MusicLibraryRemote ejb = (MusicLibraryRemote) ctx.lookup("java:global/MusicLibrary/MusicLibrary!it.pd2022.musiclibrary.MusicLibraryRemote");
        
        List&lt;Song&gt; lista = ejb.findSongs();
        for(Song s: lista)
            System.out.println(s);
    }
    
}
</code></pre>
<blockquote>
<p>üöÄ Il client della nostra applicazione √® pronto possiamo eseguirlo.
üéØ Output:</p>
<pre><code>run: nov 06, 2022 1:32:13 PM com.sun.enterprise.v3.server.CommonClassLoaderServiceImpl findDerbyClient
INFORMAZIONI: Cannot find javadb client jar file, derby jdbc driver will not be available by default.
Song{ID=2, authors=Home Free, name=Sea Shanty Medley, url=https://www.youtube.com/watch?v=lLGLUSzzuWU&amp;ab_channel=HomeFree}
Song{ID=1, authors=Queen, name=We Are The Champions, url=https://www.youtube.com/watch?v=KXw8CRapg7k&amp;ab_channel=QueenVEVO}
BUILD SUCCESSFUL (total time: 2 seconds)
</code></pre>
</blockquote>
<p><strong>Nota</strong> l'indirizzo JNDI dell'interfaccia remota del bean MusicLibrary pu√≤ essere visualizzato nella console di output di glassfish subito dopo il deploy dell'applicazione.</p>
<h1 id="esercizio-2---music-library-"><a class="header" href="#esercizio-2---music-library-">Esercizio 2 - Music Library++ üéµüìö</a></h1>
<p>Aggiungere le seguenti funzionalit√† al progetto MusicLibrary:</p>
<ol>
<li>
<p>Ampliare la definzione di <code>Song</code> inserendo:</p>
<ul>
<li>anno di rilascio,</li>
<li>numero di visualizzazioni (numero di volte in cui il bravo √® stato riprodotto),</li>
<li>lyrics;</li>
<li>specificare delle nuove NamedQuery che permettano la ricerca delle canzoni per anno di rilascio, nome autore, nome del brano.</li>
</ul>
</li>
<li>
<p>Definire una nuova entit√† <code>Playlist</code> che consente di collezionare molteplici <code>Song</code>, specificando</p>
<ul>
<li>nome,</li>
<li>autore,</li>
<li>tipologia,</li>
<li>descrizione,</li>
<li>data in cui √® stato effettuato l'ultimo aggiornamento.</li>
</ul>
<p>Le playlist possono essere create, modificate, visualizzate, ricercate per tipologia, ed eliminate senza eliminare dal database i brani contenuti.</p>
</li>
<li>
<p>Ampliare la definizione di <code>MusicLibrary</code> per supportare le precedenti nuove entit√† e funzionalit√†.</p>
<ul>
<li>Introdurre la definizione di una metodo <code>play(song_ID)</code> che permette di ottenere la URL di una song, questo metodo va intercettato per aggiornare il numero di volte che un particolare brano viene riprodotto. Modificare il file <code>beans.xml</code> per aggiungere la definizione del nuovo interceptor:</li>
</ul>
<pre><code class="language-xml">  &lt;beans xmlns="http://xmlns.jcp.org/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"
        version="1.1" bean-discovery-mode="all"&gt;
    &lt;interceptors&gt;
       &lt;class&gt;org.agoncal.book.javaee7.chapter02.LoggingInterceptor&lt;/class&gt;
     &lt;/interceptors&gt;
 &lt;/beans&gt;
</code></pre>
<ul>
<li><em>Opzionale</em>: estendere la definizione del metodo play per la riproduzione di un lista di brani ottenuti da una particolare playlist.</li>
</ul>
</li>
</ol>
<p>Mofificare la classe main di <code>MusicLibraryClient</code> per il testing e la verifica di tutte le funzionalit√† di <code>MusicLibrary</code>.</p>
<h1 id="esercizio-3---pdtify--"><a class="header" href="#esercizio-3---pdtify--">Esercizio 3 - PDtify üéµ ‚èØÔ∏è</a></h1>
<p><strong>Obiettivo</strong>: creare un enterprise java application con due moduli principali un modulo di business/persistenza e un modulo di presentazione web che permetta la gestione di una libreria musicale evoluta (playlist) utilizzando come player di riproduzione web le API di Youtube Embedded.</p>
<ul>
<li>‚ö†Ô∏è <strong>prima di procedere effettuare l'undeploy del progetto precedente dal server glassfish</strong>.</li>
<li><code>PDtify</code>: New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Enterprise ‚û°Ô∏è Enterprise Application</li>
<li>Output in Netbeans:
<ul>
<li><code>PDtify</code> enterprise application.</li>
<li><code>PDtify-ejb</code> un modulo ejb.</li>
<li><code>PDtify-web</code> un modulo web.</li>
</ul>
</li>
<li>Riportare il progetto <code>MusicLibray</code> nel modulo <code>PDtify-ejb</code>.</li>
<li>Costruire un nuovo client web utilizzando una servelet <code>MusicPlayer</code> che sfrutta l'EJB <code>MusicLibrary</code> per offrire attraverso una pagina web tutte le funzionalit√† dell'applicazione. Quando si crea la Servlet specificare <em>Add information to the deployment descriptor (web.xml)</em> passaggio 2 del wizard di creazione della Servlet.</li>
<li><em>Note</em>:
<ul>
<li>riportare nel modulo ejb tutte le definizione di persistence e beans.xml;</li>
<li>quando si eseguono le operazioni di build, deploy, e run del progetto vanno lanciate dal progetto principale entrprise <code>PDtify</code>;</li>
<li>per specificare che di default la index della nostra applicazione sar√† la Servlet <code>MusicPlayer</code> modificare il file <code>PDtify-war/Web Pages/WEB-INF/web.xml</code> come segue:
<pre><code class="language-xml">    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;MusicPlayer&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</code></pre>
</li>
</ul>
</li>
<li><code>play()</code>la visualizzazione del metodo play pu√≤ essere ottenuta utilizzando l'embedding della URL di un brano all'interno di un iframe:
<pre><code class="language-java">     Song s =  new Song("Queen","We Are The Champions", new URL("https://www.youtube.com/embed/KXw8CRapg7k"));
     out.println("&lt;iframe width=\"420\""+
                         "height=\"315\"\n" +
                         "src=\""+s.getUrl()+"\"&gt;\n" +
                 "&lt;/iframe&gt;");
</code></pre>
</li>
</ul>
<h1 id="esercizi-bonus"><a class="header" href="#esercizi-bonus">Esercizi Bonus</a></h1>
<h2 id="esercizio-b1---calcolatrice-ejb"><a class="header" href="#esercizio-b1---calcolatrice-ejb">Esercizio B.1 - Calcolatrice EJB</a></h2>
<p>Scrivere un client Java che invoca degli EJB sul server che implementano un servizio di calcolatrice per tipi float. La calcolatrice offre tre metodi, tutti prendono in input due operandi di tipo <code>float</code> e restituiscono un <code>float</code>:</p>
<ul>
<li><code>add(float,float)</code></li>
<li><code>sub(float,float)</code></li>
<li><code>multiply(float,float)</code></li>
</ul>
<p>Il server offre inoltre un servizio di counting <code>count()</code> che restituisce il numero di operazioni effettuate da tutti i clienti dall‚Äôavvio del server. Il client deve offrire da console un interfaccia che permetta di effettuare tutte le operazioni da remoto.</p>
<h2 id="esercizio-b2---calcolatrice-ejb-basata-su-stack"><a class="header" href="#esercizio-b2---calcolatrice-ejb-basata-su-stack">Esercizio B.2 - Calcolatrice EJB basata su stack</a></h2>
<p>Scrivere un client Java che invoca degli Enterprise EJB sul server che implementano un servizio di calcolatrice basata su stack per tipi <code>float</code>. La calcolatrice offre cinque metodi. Tre di questi metodi rappresentano operazioni aritmetiche che non prendono input e operano direttamente sui dati nello stack: <code>add()</code>, <code>sub()</code>, <code>multiply()</code>.
In aggiunta, il server offre il metodovoid <code>push(float)</code> e <code>float pop()</code> per la gestione dello stack. Nota che l‚Äôunico metodo che restituisce valori √® la <code>pop()</code>. Le operazione aritmetiche eseguono implicitamente due <code>pop()</code> per prelevare gli operandi e una <code>push()</code> per salvare il valore di ritorno.</p>
<p>Esempio di esecuzione del servizio:</p>
<ul>
<li><code>push(3)</code>, <code>push(4)</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 7</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>multiply()</code>, <code>pop()</code> ‚û°Ô∏è 12</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>push(1)</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 5</li>
<li><code>push(3)</code>, <code>push(4)</code>, <code>push(1)</code>, <code>add()</code>, <code>add()</code>, <code>pop()</code> ‚û°Ô∏è 8</li>
</ul>
<p>Avanzato: gestire i meccanismi di attivazione e passivazione.</p>
<h2 id="esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente"><a class="header" href="#esercizio-b3---calcolatrice-ejb-basata-su-stack-persistente">Esercizio B.3 - Calcolatrice EJB basata su stack persistente</a></h2>
<p>Estendere il servizio di calcolatrice basata su stack implementata nell‚Äôesercizio precedente aggiungendo un livello di persistenza dello stack. In particolare, ad ogni operazione, lo stack deve essere salvato su database. All‚Äôinterfaccia del servizio verr√† aggiunto il metodo <code>loadStack(String stackName)</code> e <code>saveStack(String stackName)</code> che consentono all‚Äôutente di caricare lo stack da database . Se il client non invoca la <code>loadStack()</code>, la sessione si avvia con uno stack vuoto. Lo stack puo essere salvato nel formato piu appropriato, anche come stringa.</p>
<p>Al fine di completare l‚Äôesercizo, occorre</p>
<ol>
<li>Implementare il metodo <code>loadStack(String username)</code>.</li>
<li>Implementare il metodo <code>saveStack(String username)</code>.</li>
<li>Implementare un metodo <code>stackList()</code> che restituisce tutti i nomi degli stack
salvati su database.</li>
<li>Implementare un interceptor che, alla fine dell‚Äôinterazione con un client, stampa una
lista dei stackName usati da quell‚Äôutente in quella sessione.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="06-ejb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="07-jms.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="06-ejb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="07-jms.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
