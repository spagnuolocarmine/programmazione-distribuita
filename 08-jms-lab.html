<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>JMS Lab - Programmazione Distribuita</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="materiale di supporto al corso di Programmazione Distribuita">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Programmazione Distribuita</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="blog.html"><strong aria-hidden="true">1.1.</strong> üîó Blog</a></li><li class="chapter-item expanded "><a href="esame_con_intercorso.html"><strong aria-hidden="true">1.2.</strong> üìù Esame: modalit√† con prove intercorso per studenti corsisti</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> 1Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> Presentazione del corso</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> Introduzione al calcolo distribuito</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> Java Thread 1</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> 2Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Java Thread 2-3</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> laboratorio Java Thread</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> Java Socket TCP 1</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> 3Ô∏è‚É£ üìï</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Java Socket TCP 2</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Java Remote Method Invocation (RMI) 1</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-rmi.html"><strong aria-hidden="true">4.2.1.</strong>  Hello World RMI</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> RMI 2</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> 4Ô∏è‚É£ üìïüìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-rmi.html"><strong aria-hidden="true">5.1.</strong> Laboratorio Java RMI</a></li><li class="chapter-item expanded "><a href="04-javaee.html"><strong aria-hidden="true">5.2.</strong> Introduzione Java Enterprise Edition (Java EE)</a></li><li class="chapter-item expanded "><a href="04-cdi.html"><strong aria-hidden="true">5.3.</strong> Contexts and Dependency Injection (CDI) - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> 5Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="05-javaee-lab.html"><strong aria-hidden="true">6.1.</strong> Laboratorio Java EE</a></li><li class="chapter-item expanded "><a href="04-cdi.html"><strong aria-hidden="true">6.2.</strong> Contexts and Dependency Injection (CDI) - Part 2</a></li><li class="chapter-item expanded "><a href="05-jpa.html"><strong aria-hidden="true">6.3.</strong> Java Persistence API - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> 6Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="05-jpa.html"><strong aria-hidden="true">7.1.</strong> JPA 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="06-jpa-lab.html"><strong aria-hidden="true">7.1.1.</strong> Laboratorio JPA</a></li></ol></li><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">7.2.</strong> Enterprise JavaBeans (EJB) - Part 1</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> 7Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">8.1.</strong> EJB - Part 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="07-ejb-lab.html"><strong aria-hidden="true">8.1.1.</strong> Laboratorio EJB (Esercizio 0)</a></li></ol></li><li class="chapter-item expanded "><a href="07-jms.html"><strong aria-hidden="true">8.2.</strong> Java Message Service - Part 1</a></li><li class="chapter-item expanded "><a href="06-ejb.html"><strong aria-hidden="true">8.3.</strong> JMS - Part 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> 8Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="06-ejb-lab.html"><strong aria-hidden="true">9.1.</strong> Laboratorio EJB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="08-jms-lab.html" class="active"><strong aria-hidden="true">9.1.1.</strong> JMS Lab</a></li></ol></li><li class="chapter-item expanded "><a href="08-ws.html"><strong aria-hidden="true">9.2.</strong> Java Web Services (WS) Parte 1</a></li><li class="chapter-item expanded "><a href="08-ws.html"><strong aria-hidden="true">9.3.</strong> Java WS Parte 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> 9Ô∏è‚É£ üìó</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="09-ws-lab.html"><strong aria-hidden="true">10.1.</strong> Laboratorio Java WS</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> Laboratorio J2EE Step-by-step</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.3.</strong> Introduzione al Cloud Computing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> 1Ô∏è‚É£0Ô∏è‚É£</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> From J2EE to Spring Framework (Teoria)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> From J2EE to Spring Framework (Pratica)</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Programmazione Distribuita</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li><a href="#esercizio-0">Esercizio 0</a></li>
<li><a href="#esercizio-1">Esercizio 1</a></li>
<li><a href="#esercizio-2">Esercizio 2</a></li>
<li><a href="#esercizio-3">Esercizio 3</a></li>
<li><a href="#esercizio-4---pdtify--%EF%B8%8F">Esercizio 4 - PDtify üéµ ‚èØÔ∏è</a></li>
</ul>
<h1 id="esercizio-0"><a class="header" href="#esercizio-0">Esercizio 0</a></h1>
<ul>
<li>Riferimento: org.agoncal.book.javaee7.chapter13</li>
<li>New Project ‚û°Ô∏è Java with Ant ‚û°Ô∏è Java Application</li>
<li>Aggiungere le dipendenze: <code>Java EE7 API Library</code> e <code>gf-client.jar</code></li>
</ul>
<ol>
<li>
<p>Definire un nuovo wrapper per i messaggi relativi ad un ordine, come segue:</p>
<pre><code class="language-java">public class OrderDTO implements Serializable {

private Long orderId;
private Date creationDate;
private String customerName;
private Float totalAmount;

public OrderDTO() {
}

public OrderDTO(Long orderId, Date creationDate, String customerName, Float totalAmount) {
    this.orderId = orderId;
    this.creationDate = creationDate;
    this.customerName = customerName;
    this.totalAmount = totalAmount;
}

//Getters and setters
//toString()
}
</code></pre>
</li>
<li>
<p>Definire un Producer di messaggi, come segue:</p>
<pre><code class="language-java">public class OrderProducer {

public static void main(String[] args) throws NamingException {
    // Creates an orderDto with a total amount parameter
    float value = 10.0;
    Float totalAmount = Float.valueOf(10);
    OrderDTO order = new OrderDTO(1234l, new Date(), &quot;Serge Gainsbourg&quot;, totalAmount);

    // Gets the JNDI context
    Context jndiContext = new InitialContext();

    // Looks up the administered objects
    ConnectionFactory connectionFactory = (ConnectionFactory) jndiContext.lookup(&quot;jms/javaee7/ConnectionFactory&quot;);
    Destination topic = (Destination) jndiContext.lookup(&quot;jms/javaee7/Topic&quot;);

    try (JMSContext jmsContext = connectionFactory.createContext()) {
    // Sends an object message to the topic
    jmsContext.createProducer().setProperty(&quot;orderAmount&quot;, totalAmount).send(topic, order);
    System.out.println(&quot;\nOrder sent : &quot; + order.toString());
    }
 }
}
</code></pre>
</li>
<li>
<p>Definire un Consumer di messaggi, come segue:</p>
<pre><code class="language-java"> public class OrderConsumer {
 public static void main(String[] args) throws NamingException {

     // Gets the JNDI context
     Context jndiContext = new InitialContext();

     // Looks up the administered objects
     ConnectionFactory connectionFactory = (ConnectionFactory) jndiContext.lookup(&quot;jms/javaee7/ConnectionFactory&quot;);
     Destination topic = (Destination) jndiContext.lookup(&quot;jms/javaee7/Topic&quot;);

     // Loops to receive the messages
     System.out.println(&quot;\nInfinite loop. Waiting for a message...&quot;);
     try (JMSContext jmsContext = connectionFactory.createContext()) {
     while (true) {
         OrderDTO order = jmsContext.createConsumer(topic).receiveBody(OrderDTO.class);
         System.out.println(&quot;Order received: &quot; + order);
     }
     }
 }
 }
</code></pre>
</li>
</ol>
<blockquote>
<p>üöÄ A questo punto √® possibile eseguire prima il Consumer e poi il Producer.</p>
</blockquote>
<h1 id="esercizio-1"><a class="header" href="#esercizio-1">Esercizio 1</a></h1>
<p>Scrivere un client Java che produce dei messaggi per un Topic di messaging su server Enterprise. Il client invia un messaggio con l‚Äôordine per la costruzione di una moto, che √® costituita da diverse componenti:</p>
<ul>
<li>Nome modello</li>
<li>Nome telaio</li>
<li>Nome pneumatici</li>
</ul>
<p>Il server deve implementare attraverso un Message Driven Bean un servizio di notifica degli ordini, stampando a video il nome del modello della moto, del telaio e degli pneumatici. Il client deve offrire da console un‚Äôinterfaccia che permetta di effettuare tutte le operazioni da remoto.</p>
<p>Note</p>
<ul>
<li>La ConnectionFactory deve chiamarsi: <code>jms/javaee7/ConnectionFactory</code></li>
<li>Il Topic deve chiamarsi: <code>jms/javaee7/Topic</code></li>
</ul>
<h1 id="esercizio-2"><a class="header" href="#esercizio-2">Esercizio 2</a></h1>
<p>Estendere l‚Äôesercizio precedente attraverso l‚Äôimplementazione di un servizio di persistenza degli ordini che salvi su una tabella del database tutti gli ordini arrivati al server. Aggiungere un Singleton che popoli il database con 2 ordini.</p>
<p>Note</p>
<ul>
<li>PersistentUnit e DB devono chiamarsi rispettivamente MotoPU e MotoDB</li>
</ul>
<h1 id="esercizio-3"><a class="header" href="#esercizio-3">Esercizio 3</a></h1>
<p>Estendere l‚Äôesercizio precedente aggiungendo un client Java che riceve i messaggi degli ordini delle moto e stampa li stampa a video; provare a ricevere tutti i messaggi inviati sul topic anche prima della sottoscrizione utilizzando un DurableConsumer. </p>
<pre><code class="language-java"> try (JMSContext jmsContext = connectionFactory.createContext()) {
    jmsContext.setClientID(&quot;uniqueID&quot;);
    JMSConsumer topicSubscriber = jmsContext.createDurableConsumer((Topic) topic, &quot;uniqueID&quot;);
    OrderDTO order = topicSubscriber.receiveBody(OrderDTO.class);
    System.out.println(&quot;Order received: &quot; + order);
    topicSubscriber.close();
}
</code></pre>
<h1 id="esercizio-4---pdtify--"><a class="header" href="#esercizio-4---pdtify--">Esercizio 4 - PDtify üéµ ‚èØÔ∏è</a></h1>
<p>Definire una nuova servlet <code>Player</code> che si occupa di visualizzare il player youtube per un particolare brano o una playlist.</p>
<ul>
<li><em>Input</em>: due parametri nel metodo GET <code>?id=x&amp;type=song|playlist</code>:
<ul>
<li><em>song</em>  viene visualizzato a tutto schermo il player youtube;</li>
<li><em>playlist</em> vengono visualizzati tutti i brani in una tabella, e mostra un tasto play per ogni brano.</li>
</ul>
</li>
</ul>
<p>Quando la servlet viene caricata in modalit√† <em>song</em> viene inviato un nuovo messaggio sul Topic <code>jsm/musicplayer/Player</code> (utilizzare la factory di default di installazione di glassfish) contenete l'identificativo del brano. Se la servlet viene caricata in modalit√† <em>playlist</em>  si invia un messaggio sempre sullo stesso topic con l'identificativo della playlist.
La gestione dei messaggi avviene tramite l'utilizzo di MDB e degli eventi, per ogni messaggio si genera un messaggio di log visualizzato nella console di glassfish.</p>
<p>Sviluppare il progetto come segue:</p>
<ul>
<li>
<p>Definire due nuovi Qualifier <code>SongEvent</code> e <code>PlaylistEvent</code>. </p>
</li>
<li>
<p>Definire un wrapper di messaggi <code>MessageWrapper</code> che permette di memorizzare l'id di un brano o di una playlist ed il relativo tipo di messaggio song/playlist.</p>
</li>
<li>
<p>Definire un nuovo message-driven bean <code>MusicLibraryMDB</code> che implementa <code>MessageListener</code>, per ogni messaggio ricevuto (MessageWrapper) si esegue il fire di un nuovo evento con body la relativa Song o Playlist.</p>
</li>
<li>
<p>Definire due nuove classi <code>SongNotification</code>e <code>PlaylistNotification</code> che definiscono un singolo metodo <code>notify</code> che definisce un'opportuna <code>@Observes</code> di un entit√† <code>Song</code> o <code>Playlist</code> (parametro del metodo) con l'obiettivo di visualizzare un messaggio di log.</p>
<pre><code class="language-java">    public class PlaySongNotification {
        public void notify(@Observes Song s){
            System.out.println(&quot;Playing song &quot;+s.getName());
        }
    }
</code></pre>
</li>
<li>
<p>Definire un nuovo stateless EJB <code>EventProducer</code> che consente di inviare messaggi su Topic <code>jsm/musicplayer/Player</code>.</p>
</li>
<li>
<p>Definire una nuova servlet <code>Player</code>che si comporta come descritto ed utilizza l'<code>EventProducer</code> per notificare il play di un brano. </p>
</li>
<li>
<p>Definire un client Java <code>MDBtest</code> nel package test del ptrogetto EJB che definire un metodo main nel quale si esegue il test di tutte le funzionalit√† di scambio di messaggi definiti (aggiungere il file gf-client.jar come dipendenza).</p>
</li>
<li>
<p>Modificare la servlet <code>MusicPlayer</code> al fine di utilizzare la nuova servlet <code>Player</code>per effettuare il play di un brano o una playlist.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="06-ejb-lab.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="08-ws.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="06-ejb-lab.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="08-ws.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
